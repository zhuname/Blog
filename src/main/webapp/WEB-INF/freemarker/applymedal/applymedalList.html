<#escape x as x?html>

<script type="text/javascript" src="${ctx}/js/system/applymedal/applymedal.js"></script>

<script type="text/javascript">

function deleteApplyMedal(){
	var id=jQuery("#id").val();
	if(!id||id==""){
		myalert("请选择你要删除的记录");
		return;
	}else{
		var _url="${ctx}/system/applymedal/delete?id="+id;
		var listurl="${ctx}/system/applymedal/list";
		mydelete(_url,listurl);
	}
}

function checkRefuse(id){
	var reason = prompt("请填写拒绝原因:","");
	if(reason == null || reason == ""){
		myalert("请输入拒绝原因");
		return;
	}
	jQuery.post("${ctx}/system/applymedal/fail/json",{ id: id, reason: reason },
			function(_json) {
				if (_json.status == "success") {
					myalert("审核成功");
					myhref("${ctx}/system/applymedal/list")
					return false;
				} else {
					myalert("审核失败");
					return false;
				}
	});
	
}

//点击播放视频
$(document).on("click", ".vid", function() {
    	var a = $(this).attr("src");
    	if(a != ""){
    		//iframe层-多媒体
        	layer.open({
        	  type: 2,
        	  title: false,
        	  area: ['630px', '360px'],
        	  shade: 0.8,
        	  closeBtn: 0,
        	  shadeClose: true,
        	  content: a
        	});
        	layer.msg('点击任意处关闭');
    	}else{
    		myalert("暂无可播放的视频");
    	}
	});
	
jQuery(document).ready(function(){
	
	//回选 下拉框
	jQuery("#search_type option[value='${(returnDatas.queryBean.type)!''}']").prop("selected",true);
	
	jQuery("#search_status option[value='${(returnDatas.queryBean.status)!''}']").prop("selected",true);
	
});


</script>


	

<!-- /.page-header -->

<div class="row">
    <div class="col-xs-12">
<div class="operate panel panel-default" style="height:65px;">
	<div class="panel-body">
		<div class="pull-left">
 <form class="form-horizontal" name="searchForm" id="searchForm" action="${ctx}/system/applymedal/list" role="form">
            <input type="hidden" name="pageIndex" id="pageIndex" value="${(returnDatas.page.pageIndex)!'1'}"/>
            <input type="hidden" name="sort" id="page_sort" value="${(returnDatas.page.sort)!'desc'}"/>
            <input type="hidden" name="order" id="page_order" value="${(returnDatas.page.order)!'id'}"/>
			<label for="search_type"><b>申请类型:</b></label> 
			 <select id="search_type" name="type" class="col-10" >
			 	<option value="">请选择</option>
				<option value="1">图片认证</option>
				<option value="2">视频认证</option>
			</select>
			
			<label for="search_status"><b>申请状态:</b></label> 
			 <select id="search_status" name="status" class="col-10" >
			 	<option value="">请选择</option>
				<option value="1">申请中</option>
				<option value="2">申请成功</option>
				<option value="3">申请失败</option>
			</select>
			<a  href="javascript:mySubmitForm('searchForm');"
				class="btn btn-purple btn-sm">
					查询 <i class="ace-icon fa fa-search icon-on-right bigger-10"></i>
				</a>

</form>
		</div>
		<div class="pull-right">
			    <@shiro.hasPermission name="/applymedal/list/export" >
				  <button onclick="myexport('searchForm','${ctx}/applymedal/list/export');" class="btn  btn-sm  btn-primary">
                        导出
                    </button>
		    	</@shiro.hasPermission>
			    <@shiro.hasPermission name="/applymedal/update" >
				  <button onclick="myhref('${ctx}/applymedal/update/pre');" class="btn  btn-sm  btn-primary">
                        添加
                    </button>
			    </@shiro.hasPermission>
			    <@shiro.hasPermission name="/applymedal/delete" >
			    |
				  <button onclick="deleteApplyMedal();" class="btn btn-sm btn-danger">
                        删除
                    </button>
			    </@shiro.hasPermission>
			
		</div>
	</div>
</div>

   <div class="row">
            <div class="col-xs-12">
	            <!--start_export-->
                <table id="listDataTable" border="1" class="table table-striped table-bordered table-hover">
                    <!--end_no_export-->
                    <!--first_start_export-->
                    <thead>
                    <tr>
                        <!--first_start_no_export-->
                        <th class="center">
                            <label class="position-relative">
                                <input class="ace" type="checkbox">
                                <span class="lbl"></span>
                            </label>
                        </th>
                        <th>操作</th>
                        <!--first_end_no_export-->
						<th id="th_userId" >用户名称</th>
						<th id="th_medalId" >勋章名称</th>
						<th id="th_status" >状态</th>
						<th id="th_applyTime" >申请时间</th>
						<th id="th_operTime" >审核时间</th>
						<th id="th_reason" >失败原因</th>
						<th id="th_multiAddress" >多媒体地址</th>
						<th id="th_type" >类型</th>
                    </tr>
                    </thead>
                    <!--first_end_export-->

                    <!--start_export-->
                    <tbody>
           
				   <#if (returnDatas.data??)&&(returnDatas.data?size>0)>
					 <#list returnDatas.data as _data>
                            <!--start_no_export-->
                            <tr class="">
                                <td class="center">
                                    <label class="position-relative">
                                        <input name="check_li" value="${_data.id}" class="ace" type="checkbox">
                                        <span class="lbl"></span>
                                    </label>
                                </td>
                                <td>
                                    <div class="hidden-sm hidden-xs btn-group">
                                        <button class="btn btn-xs btn-info"
                                                onclick="myhref('${ctx}/applymedal/update/pre?id=${(_data.id)!''}');">
                                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                                        </button>
                                        <button class="btn btn-xs btn-danger"
                                                onclick="mydelete('${ctx}/applymedal/delete?id=${(_data.id)!''}','${ctx}/applymedal/list');">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </button>
                                        
                                        <#if (_data.status) == 1>
                                            <button class="btn btn-xs btn-success" title="审核成功"
                                                onclick="mydelete('${ctx}/system/applymedal/check/json?id=${(_data.id)!''}','${ctx}/system/applymedal/list');">
                                            	<i class="ace-icon fa fa-check bigger-120"></i>
                                        	</button>
                                        	<button class="btn btn-xs btn-pink" title="审核失败"
                                                onclick="checkRefuse(${(_data.id)!''})">
                                            	<i class="ace-icon fa fa-close bigger-120"></i>
                                        	</button>
                                        </#if>
                                        
                                        
                                    </div>
                                    <div class="hidden-md hidden-lg">
                                        <div class="inline position-relative">
                                            <button class="btn btn-minier btn-primary dropdown-toggle"
                                                    data-toggle="dropdown" data-position="auto">
                                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
	                                          <li>
													<a  href="javascript:myhref('${ctx}/applymedal/look?id=${(_data.id)!''}');"  class="tooltip-info" data-rel="tooltip" title="View">
														<span class="blue">
															<i class="ace-icon fa fa-search-plus bigger-120"></i>
														</span>
													</a>
											  </li>	
                                                <li>
                                                    <a data-original-title="Edit"
                                                       href="javascript:myhref('${ctx}/applymedal/update/pre?id=${(_data.id)!''}');"
                                                       class="tooltip-success" data-rel="tooltip" title="">
																		<span class="green">
																			<i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
																		</span>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a data-original-title="Delete"
                                                       href="javascript:mydelete('${ctx}/applymedal/delete?id=${(_data.id)!''}','${ctx}/applymedal/list');"
                                                       class="tooltip-error" data-rel="tooltip" title="">
																		<span class="red">
																			<i class="ace-icon fa fa-trash-o bigger-120"></i>
																		</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                                <!--end_no_export-->

							<td >
								${(_data.userName)!0}
							</td>
							<td >
								${(_data.medalName)!0}
							</td>
							
							<td >
								<#if (_data.status) == 1 >
									申请中
								</#if>
								<#if (_data.status) == 2 >
									申请成功
								</#if>
								<#if (_data.status) == 3 >
									申请失败
								</#if>
							</td>
							<td >
								<!--日期型-->
							${((_data.applyTime)?string('yyyy-MM-dd'))!''}
							</td>
							<td >
								<!--日期型-->
							${((_data.operTime)?string('yyyy-MM-dd'))!''}
							</td>
							<td >
								${(_data.reason)!''}
							</td>
							<td >
								<#if (_data.type) == 1 >
									<#list "${(_data.multiAddress)!''}"?split(";") as s>
										<img height="120px" width="120px" alt="" class="im" src="${s}" >
									</#list>
									
								</#if>
								<#if (_data.type) == 2 >
									<video class="vid" poster="" width='200px' src="${(_data.multiAddress)!''}" id='mediaUrl' controls='controls'></video>
								</#if>
							</td>
							<td >
								<#if (_data.type) == 1 >
									图片
								</#if>
								<#if (_data.type) == 2 >
									视频
								</#if>
							</td>
						</tr>
					</#list>
					 </#if>
                    </tbody>
                </table>
                <!--end_export-->
            </div>
            <!-- /.span -->
        </div>
        <#if returnDatas.page??>	
            <@h.pagetoolbar page=returnDatas.page formId='searchForm' />
         </#if>
    </div>
</div>
<!-- /.main-container -->
</#escape>